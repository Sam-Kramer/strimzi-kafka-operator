To configure custom authentication, set the `type` property to `custom`.

Custom authentication allows for any type of kafka supported authentication to be used.

.Example Custom authentication for a bespoke OAuth setup
[source,yaml,subs="attributes+"]
----
spec:
  kafka:
    config:
      principal.builder.class: SimplePrincipal.class
    listeners:
      - name: oauth-bespoke
        port: 9093
        type: internal
        tls: true
        authentication:
          type: custom
          sasl: true
          listener-config:
            oauthbearer.sasl.client.callback.handler.class: client.class
            oauthbearer.sasl.server.callback.handler.class: server.class
            oauthbearer.sasl.login.callback.handler.class: login.class
            oauthbearer.connections.max.reauth.ms: 999999999
            sasl.enabled.mechanisms: oauthbearer
            oauthbearer.sasl.jaas.config: |
              org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required ;
          secrets:
            - name: example
----

.Protocol Map
The protocol map that is generated for Strimzi uses the above `sasl` and `tls` fields to determine which protocol to map to the listener.

* SASL = True, TLS = True -> SASL_SSL
* SASL = False, TLS = True -> SSL
* SASL = True, TLS = False -> SASL_PLAINTEXT
* SASL = False, TLS = False -> PLAINTEXT

.Listener Config
All configuration listed under `listener-config` will be prefixed with `listener.name.<listener-name>-<port>`.
Therefore, the above `sasl.enabled.mechanisms` becomes `listener.name.<listener-name>-<port>.sasl.enabled.mechanisms`.

.Secrets
`Secrets` will be mounted to `/opt/kafka/custom-auth-secrets/custom-<listener-name>-<port>/<secret-name>` in the Kafka broker nodes' containers.

For example, the mounted secret `example` in the above setup would be located at `/opt/kafka/custom-auth-secrets/custom-oauth-bespoke-9093/example`.

.Principal
A custom principal builder can be set in the general Kafka cluster config.

However, please note while it is possible to set your own principal builder, there are some requirements:

. The specified principal builder class exists on the image.
If you're using the open source Strimzi images, you'll need to rebuild your own with your desired classes.
*Note --* It's worth opening a Github issue on this particular problem _before_ building your own, as one may already exist.
. No other listener is using `oauth` type authentication.
This is because the Oauth listener forcefully appends its own principlar builder to the kafka config.
. The specified principal builder is compatible with Strimzi.

Custom principal builders need to support peer certificates for authentication, as Strimzi uses this to manage the Kafka cluster.
This is expected to be identical, or very similar to https://github.com/strimzi/strimzi-kafka-oauth/blob/main/oauth-server/src/main/java/io/strimzi/kafka/oauth/server/OAuthKafkaPrincipalBuilder.java[Strimzi's OAuth library].
In particular, it leverages https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/security/authenticator/DefaultKafkaPrincipalBuilder.java#L73-L79[Kafka's default principal builder class], which allows the building of a principal based upon the name of the of peer certificate.
Thus, it is expected that the custom principal builder provides a principal of type "user" with the name being that of the ssl peer certificate.

An example of such a principal builder which satisfies Strimziâ€™s auth requirements:

[source,java,subs="attributes+"]
----
public final class CustomKafkaPrincipalBuilder implements KafkaPrincipalBuilder {

    public KafkaPrincipalBuilder() {}

    @Override
    public KafkaPrincipal build(AuthenticationContext context) {
        if (context instanceof SslAuthenticationContext) {
            SSLSession sslSession = ((SslAuthenticationContext) context).session();
            try {
                return new KafkaPrincipal(
                        KafkaPrincipal.USER_TYPE, sslSession.getPeerPrincipal().getName());
            } catch (SSLPeerUnverifiedException e) {
                throw new IllegalArgumentException("Cannot use an unverified peer for authentication", e);
            }
        }

        // Create your own KafkaPrincipal here
        ...
    }
}
----